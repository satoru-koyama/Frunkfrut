<% posts.each do |post| %>
  <% if post.is_deleted == false %>
    <div class="container">
      <div>
        <div class="row">
          <%= link_to user_path(post.user.id) do %>
            <!--投稿主画像-->
            <div class="col">
              <%= attachment_image_tag post.user, :image, :fill, 30, 30, format: 'jpg', fallback: "noimage.jpg", size: '30x30' %>
            </div>
          <% end %>
          <%= link_to user_path(post.user.id) do %>
            <!--投稿主ニックネーム-->
            <p class="col">
              <% if post.user.nickname.blank? %>
                no name
              <% else %>
                <%= post.user.nickname %>
              <% end %>
            </p>
          <% end %>
          <!--コメント数-->
          <p class="col">
            コメント数<%= post.comments.where(is_deleted: false).count %>
          </p>
          <!--いいねボタン-->
          <p class="col">
            <% if !post.post_favorites.find_by(user_id: current_user.id) && user_signed_in? && current_user.id != post.user_id %>
              <%= link_to post_post_favorites_path(post.id), method: :post do %>
                いいねを付ける<i class="fas fa-thumbs-up" style="color: blue"></i>
              <% end %>
            <% elsif post.post_favorites.find_by(user_id: current_user.id) && user_signed_in? && current_user.id != post.user_id %>
              <%= link_to post_post_favorites_path(post_id: post.id), method: :delete do %>
                いいねを外す<i class="fas fa-thumbs-up" style="color: red"></i>
              <% end %>
            <% end %>
            <%= post.post_favorites.all.count %>
          </p>
        </div>
        <%= link_to post_path(post.id) do %>
          <div class="row">
            <!--投稿テキスト-->
            <p class="col">
              <%= post.text %>
            </p>
          </div>
        <% end %>
        <%= link_to post_path(post.id) do %>
          <div class="row">
            <!--投稿画像-->
            <div class="col">
              <%= attachment_image_tag post, :image, :fill, 400, 250, format: 'jpg' %>
            </div>
          </div>
        <% end %>
        <div class="row">
          <!--投稿日時-->
          <p class="col">
            投稿日時<%= l post.created_at %>
          </p>
          <% if post.updated_at != post.created_at %>
            <!--更新日時-->
            <p class="col">
              更新日時<%= l post.updated_at %>
            </p>
          <% end %>
          <!--残り時間-->
          <p class="col">
            残り<%= post.countdown %>
          </p>
          <!--報告ボタン-->
          <p class="col">
            <% if !post.post_reports.find_by(user_id: current_user.id) && user_signed_in? && current_user.id != post.user_id %>
              <%= link_to post_post_reports_path(post.id), method: :post do %>
                報告をする<i class="fas fa-exclamation-triangle" style="color: blue"></i>
              <% end %>
            <% elsif post.post_reports.find_by(user_id: current_user.id) && user_signed_in? && current_user.id != post.user_id %>
              <%= link_to post_post_reports_path(post_id: post.id), method: :delete do %>
                報告を取り消す<i class="fas fa-exclamation-triangle" style="color: red"></i>
              <% end %>
            <% end %>
          </p>
          <!--投稿主がログインユーザーの場合に表示-->
          <% if post.user_id == current_user.id %>
            <!--編集ボタン-->
            <div class="col">
              <button>編集する</button>
            </div>
            <!--更新するボタン-->
            <div class="col">
              <%= link_to post_path(post.id), method: :patch do %>
                <button>更新する</button>
              <% end %>
            </div>
            <!--取り消すボタン-->
            <div class="col">
              <%= link_to delete_post_path(post.id), method: :patch do %>
                <button>取り消す</button>
              <% end %>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  <% elsif post.is_deleted == true && (post.comments.find_by(is_deleted: false) || post.replies.find_by(is_deleted: false)) %>
    <div class="container">
      <div>
        <div class="row">
          <!--コメント数-->
          <p class="col">
            コメント数<%= post.comments.where(is_deleted: false).count %>
          </p>
        </div>
        <%= link_to post_path(post.id) do %>
          <div class="row">
            <!--投稿テキスト-->
            <p class="col">
              削除されました。
            </p>
          </div>
        <% end %>
        <div class="row">
          <!--投稿日時-->
          <p class="col">
            投稿日時<%= l post.created_at %>
          </p>
          <!--削除日時-->
          <p class="col">
            削除日時<%= l post.updated_at %>
          </p>
          <!--残り時間-->
          <p class="col">
            残り<%= post.countdown %>
          </p>
        </div>
      </div>
    </div>
  <% end %>
<% end %>